#!/usr/bin/env python3
"""–°–æ–∑–¥–∞–Ω–∏–µ GitHub —Ä–µ–ª–∏–∑–∞ —á–µ—Ä–µ–∑ API."""

import subprocess
import sys

import requests

# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –∫–æ–º–º–∏—Ç
try:
    commit_sha = subprocess.check_output(['git', 'rev-parse', 'HEAD'], text=True).strip()
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è commit SHA: {e}")
    sys.exit(1)

# GitHub API
repo = 'Prot1vn1kk/TZshnik'
tag = '2.0.2'

release_data = {
    'tag_name': tag,
    'target_commitish': commit_sha,
    'name': f'v{tag} - –ë–æ—Ç —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏ + –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è',
    'body': '''## üéØ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ

### ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–ë–æ—Ç —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏** ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ç–∏–∫–µ—Ç-—Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–î–≤–æ–π–Ω–æ–π –∑–∞–ø—É—Å–∫** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –∏ –±–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- **Cross-bot —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** ‚Äî –∞–¥–º–∏–Ω –æ—Ç–≤–µ—á–∞–µ—Ç —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥: –∫–Ω–æ–ø–∫–∞ "–†–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å" –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å—Ç–∞–≤–∏–ª–∞ –Ω–µ–≤–µ—Ä–Ω—ã–π —Å—Ç–∞—Ç—É—Å
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º —Ç–µ–ø–µ—Ä—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ (–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π —Ç–∏–∫–µ—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–ø–µ—á–∞—Ç–∫–∞ –≤ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –±–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã –≤–æ –≤—Å–µ—Ö —Å–ø–∏—Å–∫–∞—Ö —Ç–∏–∫–µ—Ç–æ–≤

### üì¶ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Python 3.9+ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Optional[]` –≤–º–µ—Å—Ç–æ `|`)
- –î–æ–±–∞–≤–ª–µ–Ω—ã `requests` –∏ `packaging` –≤ requirements.txt –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ú–æ–¥–µ–ª–∏ `SupportTicket` –∏ `SupportMessage` –≤ –ë–î
- CRUD –º–æ–¥—É–ª—å `support_crud.py` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∏–∫–µ—Ç–∞–º–∏
- –°–µ–∫—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

## üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é

### –î–ª—è VPS —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º:
```bash
# –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ
python app.py
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
2. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```env
SUPPORT_BOT_TOKEN=your_support_bot_token_here
SUPPORT_BOT_USERNAME=your_support_bot_username
```
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `python app.py`

–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç.

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
–ù–µ—Ç

---

**Commits**: https://github.com/Prot1vn1kk/TZshnik/compare/2.0.1...2.0.2
''',
    'draft': False,
    'prerelease': False
}

# –°–æ–∑–¥–∞—ë–º —Ä–µ–ª–∏–∑
url = f'https://api.github.com/repos/{repo}/releases'
print(f"–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞ {tag}...")

response = requests.post(url, json=release_data)

if response.status_code == 201:
    release_url = response.json()['html_url']
    print(f"OK: –†–µ–ª–∏–∑ {tag} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!")
    print(f"URL: {release_url}")
    sys.exit(0)
else:
    print(f"ERROR: –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–ª–∏–∑–∞: {response.status_code}")
    print(response.text)
    sys.exit(1)
