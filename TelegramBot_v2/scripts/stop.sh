#!/bin/bash
# ==============================================
# –¢–ó—à–Ω–∏–∫ v2.0 - –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞
# ==============================================

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞..."

# –ù–∞—Ö–æ–¥–∏–º PID –ø—Ä–æ—Ü–µ—Å—Å–∞
PID=$(pgrep -f "python -m bot" || pgrep -f "python3 -m bot")

if [ -z "$PID" ]; then
    echo "‚ö†Ô∏è –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω"
    exit 0
fi

echo "üìç –ù–∞–π–¥–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å: $PID"

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º SIGTERM –¥–ª—è graceful shutdown
kill -SIGTERM "$PID" 2>/dev/null

# –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 10 —Å–µ–∫—É–Ω–¥)
for i in {1..10}; do
    if ! ps -p "$PID" > /dev/null 2>&1; then
        echo "‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        exit 0
    fi
    sleep 1
done

# –ï—Å–ª–∏ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
echo "‚ö†Ô∏è –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
kill -SIGKILL "$PID" 2>/dev/null
echo "‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ"
