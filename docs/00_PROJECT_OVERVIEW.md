# 📋 ОБЗОР ПРОЕКТА "ТЗшник v2.0"

> Telegram-бот для автоматической генерации технических заданий (ТЗ) для инфографики товаров на маркетплейсах Wildberries и Ozon.

---

## 🎯 ЦЕЛЬ ПРОЕКТА

Создать **стабильный, качественный и прибыльный** Telegram-бот, который:
1. Принимает фото товара
2. Анализирует его с помощью AI (Vision)
3. Генерирует структурированное ТЗ для дизайнера
4. Отдаёт результат в удобном формате (текст + PDF)

---

## 🛠 ТЕХНОЛОГИЧЕСКИЙ СТЕК

| Компонент | Технология | Обоснование |
|-----------|------------|-------------|
| **Язык** | Python 3.11+ | Стабильность, asyncio |
| **Фреймворк бота** | aiogram 3.x | Современный, async, хорошая документация |
| **База данных** | SQLite + aiosqlite | Простота, не требует сервера |
| **ORM** | SQLAlchemy 2.0 (async) | Типизация, миграции |
| **AI Vision** | GLM-4V (Z.AI) → Gemini Flash (fallback) | Есть подписка, бесплатный fallback |
| **AI Text** | GLM-4 → Gemini Flash (fallback) | Качественный русский язык |
| **Платежи** | YooKassa (через BotFather) | Уже настроено |
| **PDF генерация** | WeasyPrint или FPDF2 | Бесплатно, качественно |

---

## 📁 СТРУКТУРА ПРОЕКТА

```
TelegramBot_v2/
├── bot/
│   ├── __init__.py
│   ├── main.py                 # Точка входа
│   ├── config.py               # Настройки из .env
│   ├── keyboards.py            # Все клавиатуры
│   └── handlers/
│       ├── __init__.py
│       ├── start.py            # /start, /help, онбординг
│       ├── photo.py            # Приём фото
│       ├── generation.py       # Процесс генерации ТЗ
│       ├── payment.py          # Платежи YooKassa
│       ├── history.py          # История ТЗ
│       └── admin.py            # Админ-команды
├── core/
│   ├── __init__.py
│   ├── ai_providers/
│   │   ├── __init__.py
│   │   ├── base.py             # Абстрактный класс провайдера
│   │   ├── glm.py              # Z.AI GLM-4 / GLM-4V
│   │   └── gemini.py           # Google Gemini (fallback)
│   ├── generator.py            # Основная логика генерации
│   ├── validator.py            # Валидация качества ТЗ
│   ├── prompts.py              # Все промпты для AI
│   └── pdf_export.py           # Генерация PDF
├── database/
│   ├── __init__.py
│   ├── models.py               # SQLAlchemy модели
│   ├── crud.py                 # CRUD операции
│   └── database.py             # Подключение к БД
├── utils/
│   ├── __init__.py
│   ├── progress.py             # Прогресс-бар генерации
│   └── helpers.py              # Вспомогательные функции
├── tests/
│   ├── test_ai_providers.py
│   ├── test_generator.py
│   └── test_validator.py
├── data/
│   └── database.sqlite         # Файл БД (создаётся автоматически)
├── exports/
│   └── (PDF файлы)             # Временное хранение PDF
├── .env                        # Секреты (не в git!)
├── .env.example                # Пример .env
├── requirements.txt
├── README.md
└── docs/                       # ← ЭТА ПАПКА
    ├── 00_PROJECT_OVERVIEW.md
    ├── 01_RULES_FOR_AI.md
    ├── 02_DATABASE_SCHEMA.md
    ├── 03_AI_PROVIDERS.md
    ├── 04_PROMPTS.md
    └── 05_STEP_BY_STEP/
        ├── STEP_01_SETUP.md
        ├── STEP_02_DATABASE.md
        ├── STEP_03_AI_PROVIDERS.md
        ├── STEP_04_HANDLERS.md
        ├── STEP_05_GENERATION.md
        ├── STEP_06_PAYMENTS.md
        └── STEP_07_FINAL.md
```

---

## 🔄 ОСНОВНОЙ ФЛОУ

```
┌─────────────────────────────────────────────────────────────────┐
│                        ПОЛЬЗОВАТЕЛЬ                             │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  1. /start → Приветствие + 1 бесплатное ТЗ                     │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  2. Загружает фото товара (1-5 шт.)                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  3. Выбирает категорию товара (inline кнопки)                  │
│     [Одежда] [Электроника] [Косметика] [Дом] [Другое]          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  4. Проверка баланса (есть кредиты?)                           │
│     ├── Да → продолжаем                                        │
│     └── Нет → предлагаем купить пакет                          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  5. ГЕНЕРАЦИЯ (с прогресс-баром)                               │
│     ┌────────────────────────────────────────────┐             │
│     │ ✅ Анализ фото                             │             │
│     │ ✅ Изучение целевой аудитории              │             │
│     │ 🔄 Генерация текстов... (60%)              │             │
│     │ ⬜ Финальная проверка                      │             │
│     └────────────────────────────────────────────┘             │
│                                                                 │
│  5.1. GLM-4V анализирует фото → описание товара                │
│  5.2. GLM-4 генерирует ТЗ по описанию                          │
│  5.3. Validator проверяет качество (8 секций, длина)           │
│  5.4. Если не прошло → retry с усиленным промптом              │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  6. Отправка результата                                        │
│     • Краткая версия в чат                                     │
│     • Кнопка [📄 Скачать PDF]                                  │
│     • Кнопка [🔄 Перегенерировать] (1 раз бесплатно)           │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  7. "Ты сэкономил ~2.5 часа работы!"                           │
│     [💳 Купить ещё] [📊 Моя статистика]                        │
└─────────────────────────────────────────────────────────────────┘
```

---

## 💰 МОНЕТИЗАЦИЯ

### Тарифы

| Пакет | Количество ТЗ | Цена | За 1 ТЗ |
|-------|---------------|------|---------|
| **Бесплатно** | 1 | 0₽ | — |
| **Старт** | 5 | 149₽ | 29.8₽ |
| **Оптимальный** | 20 | 399₽ | 19.9₽ |
| **Профи** | 50 | 699₽ | 14₽ |
| **Безлимит** | ∞/месяц | 1499₽ | — |

### Платежи
- **YooKassa** через Telegram Payments (настроено в BotFather)
- Поддержка: карты, SberPay, ЮMoney

---

## ✅ MVP ФУНКЦИОНАЛ (Must Have)

- [x] Регистрация пользователя при /start
- [x] 1 бесплатное ТЗ для новых пользователей
- [x] Загрузка 1-5 фото товара
- [x] Выбор категории товара
- [x] Прогресс-бар генерации (4 этапа)
- [x] Генерация ТЗ через GLM-4V + GLM-4
- [x] Fallback на Gemini при ошибках
- [x] Валидация качества ТЗ (8 секций)
- [x] 1 бесплатная перегенерация
- [x] Экспорт в PDF
- [x] Баланс кредитов пользователя
- [x] Оплата через YooKassa
- [x] История ТЗ (/history)

---

## 📅 ПЛАН РАЗРАБОТКИ

| Этап | Описание | Время |
|------|----------|-------|
| **1** | Настройка проекта, структура, конфиг | 2-3 часа |
| **2** | База данных (модели, CRUD) | 3-4 часа |
| **3** | AI провайдеры (GLM, Gemini, fallback) | 4-5 часов |
| **4** | Handlers бота (start, photo, generation) | 4-5 часов |
| **5** | Генерация ТЗ + валидация | 3-4 часа |
| **6** | Платежи YooKassa | 2-3 часа |
| **7** | PDF экспорт + финальная сборка | 3-4 часа |

**Итого:** ~25-30 часов разработки

---

## 📚 ДОКУМЕНТАЦИЯ

| Файл | Описание |
|------|----------|
| [01_RULES_FOR_AI.md](01_RULES_FOR_AI.md) | Правила кодирования для нейросети |
| [02_DATABASE_SCHEMA.md](02_DATABASE_SCHEMA.md) | Схема базы данных |
| [03_AI_PROVIDERS.md](03_AI_PROVIDERS.md) | Настройка AI провайдеров |
| [04_PROMPTS.md](04_PROMPTS.md) | Промпты для генерации ТЗ |
| [05_STEP_BY_STEP/](05_STEP_BY_STEP/) | Пошаговые инструкции |

---

## 🔑 ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ (.env)

```env
# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token
ADMIN_USER_ID=your_telegram_id

# AI Providers
GLM_API_KEY=your_glm_api_key
GEMINI_API_KEY=your_gemini_api_key

# Payments
YOOKASSA_PROVIDER_TOKEN=your_yookassa_token

# Database
DATABASE_URL=sqlite+aiosqlite:///data/database.sqlite

# Settings
DEBUG=false
FREE_GENERATIONS=1
```

---

*Создано: 2 февраля 2026*
*Версия: 2.0*
